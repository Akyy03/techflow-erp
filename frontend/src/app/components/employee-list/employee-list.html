<div
  class="page-header"
  style="margin-bottom: 40px; display: flex; justify-content: space-between; align-items: flex-end"
>
  <div>
    <h1
      style="font-size: 2.2rem; font-weight: 800; letter-spacing: -1.5px; margin: 0; color: white"
    >
      EMPLOYEES<span style="color: #6366f1">.</span>
    </h1>
    <p style="color: #64748b; font-size: 0.9rem; margin-top: 5px">
      Manage and monitor organization staff
    </p>
  </div>
</div>

<div
  style="
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
    margin-bottom: 35px;
  "
>
  <div style="position: relative; flex: 1; max-width: 500px">
    <span
      style="
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #6366f1;
        font-weight: 800;
        font-size: 0.75rem;
        pointer-events: none;
        z-index: 10;
      "
    >
      SEARCH_
    </span>
    <input
      type="text"
      (input)="onSearch($event)"
      placeholder="by name, position or department..."
      class="tf-input"
      style="
        padding-left: 85px !important;
        background: rgba(15, 23, 42, 0.4) !important;
        width: 100%;
      "
    />
  </div>

  <div style="display: flex; gap: 4px; align-items: center">
    <button
      (click)="viewMode.set('grid')"
      [style.color]="viewMode() === 'grid' ? '#6366f1' : '#475569'"
      style="
        background: none;
        border: none;
        cursor: pointer;
        padding: 10px;
        transition: 0.3s;
        display: flex;
        align-items: center;
      "
      title="Grid View"
    >
      <svg width="22" height="22" fill="currentColor" viewBox="0 0 24 24">
        <path d="M3 3h7v7H3V3zm11 0h7v7h-7V3zm0 11h7v7h-7v-7zM3 14h7v7H3v-7z" />
      </svg>
    </button>
    <button
      (click)="viewMode.set('table')"
      [style.color]="viewMode() === 'table' ? '#6366f1' : '#475569'"
      style="
        background: none;
        border: none;
        cursor: pointer;
        padding: 10px;
        transition: 0.3s;
        display: flex;
        align-items: center;
      "
      title="Table View"
    >
      <svg
        width="22"
        height="22"
        fill="none"
        stroke="currentColor"
        stroke-width="2.5"
        viewBox="0 0 24 24"
      >
        <path d="M3 6h18M3 12h18M3 18h18" stroke-linecap="round"></path>
      </svg>
    </button>
  </div>
</div>

<div style="display: flex; flex-wrap: wrap; gap: 24px; margin-bottom: 35px; width: 100%">
  <div
    class="bento-card"
    style="
      display: flex;
      flex-direction: column;
      justify-content: center;
      min-height: 160px;
      flex: 2.3;
      min-width: 300px;
    "
  >
    <p class="tf-label">Total Budget Allocation</p>
    <h2 style="font-size: 2.5rem; margin-top: 10px; font-weight: 300; color: white">
      {{ totalBudget() | currency: 'EUR' }}
    </h2>
    <p style="color: #6366f1; font-size: 0.7rem; font-weight: 600; margin-top: 5px">
      Avg. per employee: {{ avgSalary() | currency: 'EUR' }}
    </p>
  </div>

  <div
    (click)="openAddModal()"
    class="bento-card"
    style="
      flex: 1;
      min-width: 300px;
      border: 2px dashed rgba(99, 102, 241, 0.2);
      background: rgba(99, 102, 241, 0.02);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: 0.3s;
      min-height: 160px;
    "
    onmouseover="
      this.style.borderColor = 'rgba(99, 102, 241, 0.5)';
      this.style.background = 'rgba(99, 102, 241, 0.05)';
    "
    onmouseout="
      this.style.borderColor = 'rgba(99, 102, 241, 0.2)';
      this.style.background = 'rgba(99, 102, 241, 0.02)';
    "
  >
    <div
      style="
        width: 42px;
        height: 42px;
        border-radius: 12px;
        background: rgba(99, 102, 241, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6366f1;
        margin-bottom: 15px;
      "
    >
      <svg
        width="24"
        height="24"
        fill="none"
        stroke="currentColor"
        stroke-width="2.5"
        viewBox="0 0 24 24"
      >
        <path d="M12 5v14M5 12h14"></path>
      </svg>
    </div>
    <span
      style="
        color: #6366f1;
        font-weight: 800;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 1px;
      "
      >Add New Employee</span
    >
  </div>
</div>

<div style="display: flex; flex-direction: column; gap: 24px">
  @if (viewMode() === 'grid') {
    <div
      class="bento-grid"
      style="
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 25px;
        width: 100%;
      "
    >
      @for (emp of filteredEmployees(); track emp.id) {
        <div
          class="bento-card"
          style="position: relative; cursor: pointer; overflow: hidden; transition: 0.3s"
          onmouseover="this.style.transform = 'translateY(-5px)'"
          onmouseout="this.style.transform = 'translateY(0)'"
        >
          <div
            style="position: absolute; top: 15px; right: 15px; display: flex; gap: 8px; z-index: 10"
          >
            <button
              class="card-action-btn edit"
              (click)="$event.stopPropagation(); openEditModal(emp)"
              title="Edit Employee"
            >
              <svg
                width="16"
                height="16"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                viewBox="0 0 24 24"
              >
                <path
                  d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7M18.5 2.5a2.121 2.121 0 113 3L12 15l-4 1 1-4 9.5-9.5z"
                ></path>
              </svg>
            </button>
            <button
              class="card-action-btn delete"
              (click)="$event.stopPropagation(); deleteEmployee(emp.id!)"
              title="Delete Employee"
            >
              <svg
                width="16"
                height="16"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                viewBox="0 0 24 24"
              >
                <path
                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                ></path>
              </svg>
            </button>
          </div>

          <div
            (click)="viewEmployeeProfile(emp.id!)"
            style="display: flex; align-items: center; gap: 15px; margin-bottom: 25px"
          >
            <div style="position: relative">
              <div
                [style.border-color]="
                  emp.role === 'MANAGER' ? 'rgba(129, 140, 248, 0.6)' : 'transparent'
                "
                style="
                  width: 52px;
                  height: 52px;
                  background: linear-gradient(135deg, #6366f1, #a855f7);
                  border-radius: 14px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-weight: 800;
                  color: white;
                  font-size: 1.2rem;
                  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
                  border: 2px solid;
                "
              >
                {{ emp.firstName ? emp.firstName[0] : '?' }}
              </div>
              <div
                [style.background]="emp.role === 'MANAGER' ? '#6366f1' : '#1e293b'"
                [style.color]="emp.role === 'MANAGER' ? 'white' : '#64748b'"
                style="
                  position: absolute;
                  bottom: -4px;
                  right: -4px;
                  width: 18px;
                  height: 18px;
                  border-radius: 6px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-size: 0.65rem;
                  font-weight: 900;
                  border: 2px solid #0f172a;
                  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
                "
              >
                {{ emp.role === 'MANAGER' ? 'M' : 'E' }}
              </div>
            </div>

            <div>
              <h3 style="margin: 0; font-size: 1.05rem; color: #f8fafc; font-weight: 700">
                {{ emp.firstName }} {{ emp.lastName }}
              </h3>
              <div style="display: flex; align-items: center; gap: 5px; margin-top: 2px">
                <p
                  style="
                    margin: 0;
                    color: #6366f1;
                    font-size: 0.65rem;
                    font-weight: 700;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                  "
                >
                  {{ emp.departmentName || 'Unassigned' }}
                </p>
                <span style="color: #334155; font-size: 0.6rem">â€¢</span>
                <p style="margin: 0; color: #64748b; font-size: 0.75rem; font-weight: 500">
                  {{ emp.position }}
                </p>
              </div>
              <p
                style="
                  margin: 4px 0 0 0;
                  color: #475569;
                  font-size: 0.7rem;
                  font-family: 'JetBrains Mono', monospace;
                "
              >
                {{ emp.email }}
              </p>
            </div>
          </div>

          <div
            style="
              border-top: 1px solid rgba(255, 255, 255, 0.05);
              padding-top: 15px;
              display: flex;
              justify-content: space-between;
              align-items: center;
            "
          >
            <span
              style="
                color: #818cf8;
                font-family: 'JetBrains Mono', monospace;
                font-size: 0.9rem;
                font-weight: 600;
              "
            >
              {{ emp.salary | currency: 'EUR' }}
            </span>
            <span style="color: #334155; font-size: 0.6rem; font-weight: 700; letter-spacing: 1px"
              >REF: #0{{ emp.id }}</span
            >
          </div>
        </div>
      } @empty {
        <div
          style="
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px;
            background: rgba(15, 23, 42, 0.2);
            border-radius: 20px;
            border: 1px dashed rgba(99, 102, 241, 0.1);
          "
        >
          @if (searchQuery()) {
            <p style="color: #64748b; font-size: 1rem; margin: 0">
              No talent matching
              <span style="color: #6366f1; font-weight: 700">"{{ searchQuery() }}"</span> found.
            </p>
            <button
              (click)="searchQuery.set(''); onSearch($any({ target: { value: '' } }))"
              style="
                margin-top: 10px;
                background: none;
                border: none;
                color: #6366f1;
                cursor: pointer;
                font-weight: 700;
                text-decoration: underline;
              "
            >
              Clear Search
            </button>
          } @else {
            <p style="color: #64748b; font-size: 1rem; margin: 0">
              The talent pool is currently empty.
            </p>
            <button
              (click)="openAddModal()"
              style="
                margin-top: 10px;
                background: #6366f1;
                color: white;
                border: none;
                padding: 8px 16px;
                border-radius: 8px;
                cursor: pointer;
                font-weight: 600;
              "
            >
              + Add First Employee
            </button>
          }
        </div>
      }
    </div>
  } @else {
    <div
      class="table-container"
      style="
        width: 100%;
        overflow-x: auto;
        background: rgba(15, 23, 42, 0.3);
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.05);
      "
    >
      <table style="width: 100%; border-collapse: collapse; min-width: 800px">
        <thead>
          <tr>
            <th>Employee</th>
            <th>Position</th>
            <th>Department</th>
            <th>Salary</th>
            <th style="text-align: right; padding-right: 25px">Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (emp of filteredEmployees(); track emp.id) {
            <tr
              (click)="viewEmployeeProfile(emp.id!)"
              style="cursor: pointer; border-bottom: 1px solid rgba(255, 255, 255, 0.02)"
            >
              <td>
                <div
                  class="table-user-info"
                  style="display: flex; align-items: center; gap: 12px; padding: 12px"
                >
                  <div
                    class="table-avatar"
                    style="
                      width: 32px;
                      height: 32px;
                      background: linear-gradient(135deg, #6366f1, #a855f7);
                      border-radius: 8px;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      font-weight: bold;
                      font-size: 0.8rem;
                    "
                  >
                    {{ emp.firstName ? emp.firstName[0] : '?' }}
                  </div>
                  <div style="display: flex; flex-direction: column">
                    <div style="display: flex; align-items: center; gap: 8px">
                      <span style="font-weight: 600">{{ emp.firstName }} {{ emp.lastName }}</span>
                      <span
                        [style.color]="emp.role === 'MANAGER' ? '#818cf8' : '#475569'"
                        [style.background]="
                          emp.role === 'MANAGER' ? 'rgba(99, 102, 241, 0.1)' : 'transparent'
                        "
                        [style.border]="
                          emp.role === 'MANAGER'
                            ? '1px solid rgba(99, 102, 241, 0.2)'
                            : '1px solid rgba(255,255,255,0.05)'
                        "
                        style="
                          font-size: 0.6rem;
                          padding: 1px 5px;
                          border-radius: 4px;
                          font-weight: 800;
                        "
                      >
                        {{ emp.role === 'MANAGER' ? 'M' : 'E' }}
                      </span>
                    </div>
                    <span
                      style="font-size: 0.7rem; color: #475569; font-family: 'JetBrains Mono'"
                      >{{ emp.email }}</span
                    >
                  </div>
                </div>
              </td>
              <td style="padding: 12px">{{ emp.position }}</td>
              <td style="padding: 12px">
                <span class="dept-badge">{{ emp.departmentName || 'Unassigned' }}</span>
              </td>
              <td style="padding: 12px; font-family: 'JetBrains Mono'; color: #818cf8">
                {{ emp.salary | currency: 'EUR' }}
              </td>
              <td style="text-align: right; padding-right: 20px">
                <button (click)="$event.stopPropagation(); openEditModal(emp)" class="action-btn">
                  Edit
                </button>
                <button
                  (click)="$event.stopPropagation(); deleteEmployee(emp.id!)"
                  class="action-btn delete"
                >
                  Delete
                </button>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="5" style="text-align: center; padding: 40px; color: #64748b">
                No employees found.
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>

<div *ngIf="isModalOpen()" class="tf-modal-overlay">
  <div class="bento-card modal-box tf-modal-content">
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
      "
    >
      <h2
        style="margin: 0; font-size: 1.5rem; font-weight: 800; letter-spacing: -1px; color: white"
      >
        {{ isEditMode() ? 'UPDATE EMPLOYEE' : 'NEW EMPLOYEE' }}<span style="color: #6366f1">.</span>
      </h2>
      <button (click)="closeModal()" class="close-btn">&times;</button>
    </div>

    <form (ngSubmit)="saveEmployee()" #empForm="ngForm">
      <div style="display: grid; gap: 20px">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px">
          <div>
            <label class="tf-label">First Name</label>
            <input
              [(ngModel)]="newEmployee.firstName"
              name="firstName"
              required
              class="tf-input"
              placeholder="John"
            />
          </div>
          <div>
            <label class="tf-label">Last Name</label>
            <input
              [(ngModel)]="newEmployee.lastName"
              name="lastName"
              required
              class="tf-input"
              placeholder="Doe"
            />
          </div>
        </div>

        <div>
          <label class="tf-label">Corporate Email</label>
          <input
            [(ngModel)]="newEmployee.email"
            name="email"
            type="text"
            required
            pattern="^[a-zA-Z0-9._%+-]+@techflow\.com$"
            #emailModel="ngModel"
            class="tf-input"
            [class.tf-input-error]="emailModel.invalid && emailModel.touched"
            placeholder="j.doe@techflow.com"
          />
          <div
            *ngIf="emailModel.invalid && emailModel.touched"
            style="color: #ef4444; font-size: 0.65rem; margin-top: 5px; font-weight: 600"
          >
            <span *ngIf="emailModel.errors?.['required']">Email is required.</span>
            <span *ngIf="emailModel.errors?.['pattern']"
              >Identity Error: Use @techflow.com domain only.</span
            >
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px">
          <div>
            <label class="tf-label">Phone Number</label>
            <input
              [(ngModel)]="newEmployee.phone"
              name="phone"
              (input)="validatePhone($event)"
              required
              class="tf-input"
              placeholder="+40 7xx ..."
            />
          </div>
          <div>
            <label class="tf-label">Department</label>
            <select
              [(ngModel)]="newEmployee.department.id"
              name="empDept"
              required
              class="tf-input"
              style="appearance: auto"
            >
              <option [ngValue]="undefined" disabled selected>Assign Dept</option>
              @for (dept of departments(); track dept.id) {
                <option [value]="dept.id">{{ dept.name }}</option>
              }
            </select>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px">
          <div>
            <label class="tf-label">Position</label>
            <input
              [(ngModel)]="newEmployee.position"
              name="position"
              required
              class="tf-input"
              placeholder="Software Engineer"
            />
          </div>
          <div>
            <label class="tf-label">Salary (EUR)</label>
            <input
              [(ngModel)]="newEmployee.salary"
              name="salary"
              type="number"
              min="0"
              required
              class="tf-input"
            />
          </div>
        </div>

        <div>
          <label class="tf-label">Hire Date</label>
          <input [(ngModel)]="newEmployee.hireDate" name="hireDate" type="date" class="tf-input" />
        </div>

        <div
          *ngIf="errorMessage()"
          style="
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: #f87171;
            padding: 12px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
          "
        >
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
            <path
              d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"
            />
          </svg>
          {{ errorMessage() }}
        </div>

        <div style="margin-top: 10px; display: grid; grid-template-columns: 1fr 2fr; gap: 15px">
          <button type="button" (click)="closeModal()" class="tf-btn-secondary">Cancel</button>
          <button type="submit" [disabled]="!empForm.form.valid" class="tf-btn-primary">
            {{ isEditMode() ? 'Save Changes' : 'Deploy to System' }}
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
